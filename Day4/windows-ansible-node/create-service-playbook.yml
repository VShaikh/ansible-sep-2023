- name: Demonstrates installing JDK, Maven, git-clone, building application jar and creating a windows service
  hosts: all
  become_method: runas
  vars:
  - ansible_become_password: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          38353536643231323233376261333836653035323035643366326437396338643665323634613963
          6336353433323561393063663261613564626231656636620a653663656566323735643833383464
          64386562306537313462636233343566663639356265373333643863373563633133356136373866
          3333316630626634610a353230313534646361353266396639663666323534633536393166366436
          6632
  tasks:
  - name: Download the OpenJDK 20 zip file 
    win_get_url:
      url:  https://download.java.net/java/GA/jdk20.0.2/6e380f22cbe7469fa75fb448bd903d8e/9/GPL/openjdk-20.0.2_windows-x64_bin.zip
      dest: C:\openjdk20.zip

  - name: Unzip the OpenJDK 20
    win_unzip:
      src: C:\openjdk20.zip
      dest: C:\openjdk20

  - name: Add JDK_HOME environment variable for OpenJDK 20
    ansible.windows.win_environment:
      state: present
      name: JDK_HOME 
      value: C:\openjdk20\jdk-20.0.2 
      level: machine

  - name: Add JDK_HOME into system path 
    ansible.windows.win_path:
      elements:
      - '%JDK_HOME%\bin'

  - name: Ensure that JDK executables are in user path 
    ansible.windows.win_path:
      name: JDK 
      elements: C:\openjdk20\jdk-20.0.2\bin
      scope: user
      state: present 


